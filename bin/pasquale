#!/usr/bin/env node

'use strict';

var yargs = require('yargs')
	,	Pasquale = require('../src/main')
	,	jsonReporter = require('../src/reporter-json')
	,	argv = null
	,	pasquale = null;

/**
 * CLI
 */

argv = yargs
	.usage('Usage: $ pasquale --lang=[lang] [text]')
	.example('$ pasquale --lang=pt-br istu Ã© um testo errado')
	.options('l', {
		alias: 'lang',
		default: 'pt-br',
		description: 'The language to check spelling against'
	})
	.options('t', {
		alias: 'text',
		description: 'The text to have spelling checked against'
	})
	.options('r', {
		alias: 'reporter',
		default: 'json',
		description: 'Specifies which reporter to use'
	})
	.argv;

var lang 			= argv.l || argv.lang
	,	reporter 	= argv.r || argv.reporter
	,	text 			= argv.t || argv.text || argv._.join(' ');

if (argv.h || argv.help || !text) {
	yargs.showHelp();
	process.exit(0);
}

/**
 * Main
 */

pasquale = new Pasquale();
pasquale.setLanguage(lang);

if (process.stdin.isTTY) handleTTY();
else handlePipe();

/**
 * Control Functions
 */

function handlePipe () {
	// TODO
}

function handleTTY () {
	pasquale.checkTextSpell(text).then(function (results) {
		if (reporter.toLowerCase() === 'json') {
			console.log(jsonReporter(results));
		}
	}, function (err) {
		console.error(err);
	});
}
